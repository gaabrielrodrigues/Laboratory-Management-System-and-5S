<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="../global.css">
    <title>Tela Login</title>
    <style>
        #mensagemErro {
            color: red;
            text-align: center;
            margin: 10px 0;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <section class="BarraLoginCen">
        <div class="BarraLogin">
            <div class="iconEsenai">
                <img id="icon" src="https://www.imagemhost.com.br/images/2024/11/22/Logo-novo-SENAI_-sem-slogan_755X325.md.png" alt="Ícone do SENAI">
            </div>

            <div class="subTitulos">
                <h2>Bem-vindo ao Sistema 5S</h2>
                <p>Acesse sua conta para gerenciar os laboratórios.</p>
            </div>

            <form id="loginForm">
                <div class="infosParaLogin">

                    <div class="AreaEmailLogin">
                        <label class="label">
                            <span class="icon">
                                <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="none" viewBox="0 0 24 24">
                                    <path stroke="currentColor" stroke-width="1.25" d="M7 17v1a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1a3 3 0 0 0-3-3h-4a3 3 0 0 0-3 3Zm8-9a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"></path>
                                </svg>
                            </span>
                            <input type="text" class="input" id="matriculaInput" name="usuario" placeholder="Matrícula" autocomplete="username" />
                        </label>
                    </div>

                    <div class="AreaSenhaLogin">
                        <label class="label">
                            <span class="icon">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                                </svg>
                            </span>
                            <input type="password" class="input" id="senhaInput" name="senha" placeholder="Senha" autocomplete="current-password" />
                        </label>
                    </div>

                </div>

                <p id="mensagemErro"></p>

                <div class="esqueceuSenhaEBotaoLogin">
                    <button type="submit" class="botaoLogin">
                        Entrar
                    </button>
                    <a href="#" class="esqueceuSenha">Esqueceu sua senha?</a>
                </div>
            </form>
            </div>
    </section>

    <script>
        document.getElementById('loginForm').addEventListener('submit', async (event) => {
            
            event.preventDefault();

            const matricula = document.getElementById('matriculaInput').value;
            const senha = document.getElementById('senhaInput').value;
            const mensagemErroElement = document.getElementById('mensagemErro');
            const urlAPI = 'http://localhost:3000/login';

            mensagemErroElement.textContent = '';
            
            if (!matricula || !senha) {
                mensagemErroElement.textContent = 'Preencha todos os campos.';
                return;
            }

            const dadosLogin = {
                matricula: matricula, 
                senha: senha
            };

            try {
                const response = await fetch(urlAPI, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(dadosLogin),
                });
                if (response.ok) {
                    window.location.href = '/frontend/DashBoard-VisãoGeral/index.html'; 

                } else {
                    let errorMessage = 'Matrícula ou senha inválida.';
                    
                    try {
                        const errorData = await response.json();
                        errorMessage = errorData.message || errorMessage; 
                    } catch (e) {
                        errorMessage = `Erro de autenticação (Status: ${response.status}).`;
                    }
                    
                    mensagemErroElement.textContent = errorMessage;
                }
            } catch (error) {
                console.error('Erro na requisição de login:', error);
                mensagemErroElement.textContent = 'Não foi possível conectar ao servidor. Verifique sua conexão e se a API está rodando.';
            }
        });
    </script>
</body>

</html>